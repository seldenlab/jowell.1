# Linear metrics by site

```{r load packages 3, echo=TRUE}
# install required analysis packages
#devtools::install_github("tidyverse/tidyverse")
#devtools::install_github("mlcollyer/RRPP")
#devtools::install_github("kassambara/ggpubr")
#devtools::install_github("sinhrks/ggfortify")
#devtools::install_git('https://bitbucket.org/nicholasehamilton/ggtern')
#devtools::install_github("karthik/wesanderson")
#devtools::install_github("daattali/ggExtra")
# load libraries
library(here)
library(tidyverse)
library(RRPP)
library(ggpubr)
library(ggfortify)
library(ggtern)
library(cluster)
library(wesanderson)
library(ggExtra)
```

## Load data + define L/S

```{r setwd ld define variables 3, echo=TRUE}
# define subsets, assign L/S----
# load data
DATA <- read.csv("linear.csv", 
                 header = TRUE, 
                 as.is=TRUE)

#select vars
pre.data <- DATA %>% 
  select(spec:thickness)

# hs261 subset----
hs261 <- subset(pre.data,
                site == "41HS261",
                select = spec:thickness)

## histogram of max length
hist(hs261$length)

# calculate the mean length
meanl <- mean(hs261$length)

# assign L/S varieties based on mean length
lcheck2 <- hs261$length >= meanl
lcheck3 <- hs261$length >= 0 & hs261$length < meanl

hs261$size <- ""
hs261$size <- ifelse(lcheck2, "L", hs261$size)
hs261$size <- ifelse(lcheck3, "S", hs261$size)

# an13 subset----
an13 <- subset(pre.data,
               site == "41AN13",
               select = spec:thickness)

## histogram of max length
hist(an13$length)

# calculate the mean length
meanl <- mean(an13$length)

# assign L/S varieties based on mean length
lcheck2 <- an13$length >= meanl
lcheck3 <- an13$length >= 0 & an13$length < meanl

an13$size <- ""
an13$size <- ifelse(lcheck2, "L", an13$size)
an13$size <- ifelse(lcheck3, "S", an13$size)

# aggregate data
mx <- bind_rows(hs261, an13)

# join site and size class
qdata <- mx %>% 
  unite("merged", site, size, remove = FALSE)
```

## Boxplots for _variable_ by _site_

```{r boxsite, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE, fig.cap = "Boxplots for maximum length, width, and thickness for Jowell knives from 41AN13 and 41HS261."}
# boxplot of maximum length ~ site
sitemaxl <- ggplot(qdata, aes(x = merged, y = length, color = merged)) + 
  geom_boxplot() +
  geom_dotplot(binaxis = 'y', stackdir = 'center', dotsize = 0.3) +
  scale_colour_manual(values = wes_palette("Moonrise2")) +
  theme(legend.position = "none") +
  labs(x = 'Site', y = 'MaxL')

# boxplot of maximum width ~ site
sitemaxw <- ggplot(qdata, aes(x = merged, y = width, color = merged)) + 
  geom_boxplot() +
  geom_dotplot(binaxis = 'y', stackdir = 'center', dotsize = 0.3) +
  scale_colour_manual(values = wes_palette("Moonrise2")) +
  theme(legend.position = "none") +
  labs(x = 'Site', y = 'MaxW')

# boxplot of maximum thickness ~ site
sitemaxth <- ggplot(qdata, aes(x = merged, y = thickness, color = merged)) + 
  geom_boxplot() +
  geom_dotplot(binaxis = 'y', stackdir = 'center', dotsize = 0.3) +
  scale_colour_manual(values = wes_palette("Moonrise2")) +
  theme(legend.position = "none") +
  labs(x = 'Site', y = 'MaxTh')

# render figure
sitefigure<-ggarrange(sitemaxl,sitemaxw,sitemaxth,
                  labels = c("a","b","c"),
                  ncol = 2, nrow = 2)
              
# plot figure
sitefigure
```

## Principal Components Analysis for _site_

```{r pcasite, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE, fig.cap = "Principal Components Analysis by site."}
#attributes for plot
merged <- qdata$merged
df <- qdata[c(4:6)]
pch.gps.gp <- c(15:18)[as.factor(merged)]

#pca
pca <- autoplot(prcomp(df),
         data = qdata,
         asp = 1,
         shape = pch.gps.gp,
         colour = 'merged',
         loadings = TRUE, 
         loadings.colour = 'blue',
         loadings.label = TRUE,
         loadings.label.size = 3, 
         frame = TRUE) +
    scale_fill_manual(values = wes_palette("Moonrise2")) +
    scale_colour_manual(values = wes_palette("Moonrise2"))

ggMarginal(pca, groupColour = TRUE, groupFill = TRUE)
```

## Analyses of Variance (ANOVA) for _variable_ ~ _site_

### _Maximum length_ of Jowell knives

```{r anovasitemaxl, out.width = "100%", dpi = 300, echo=TRUE}
# anova = maximum length ~ site
siteml <- lm.rrpp(length ~ merged, 
                  SS.type = "I", 
                  data = qdata, 
                  iter = 9999, 
                  print.progress = FALSE)

# difference in max length by size class?
anova(siteml)

# pairwise comparison of LS means = which differ?
sh.pwml <- pairwise(siteml,
                     groups = qdata$merged)
summary(sh.pwml, 
        confidence = 0.95, 
        test.type = "dist")
```

### _Maximum width_ of Jowell knives

```{r anovasitemaxw, out.width = "100%", dpi = 300, echo=TRUE}
# anova = maximum width ~ site
sitemw <- lm.rrpp(width ~ merged, 
                  SS.type = "I", 
                  data = qdata, 
                  iter = 9999, 
                  print.progress = FALSE)

anova(sitemw)
```

### _Maximum thickness_ of Jowell knives

```{r anovasitemaxth, out.width = "100%", dpi = 300, echo=TRUE}
# anova = maximum thickness ~ site
sitemth <- lm.rrpp(thickness ~ merged, 
                   SS.type = "I", 
                   data = qdata, 
                   iter = 9999, 
                   print.progress = FALSE)

# difference in max thickness by size class?
anova(sitemth)

# pairwise comparison of LS means = which differ?
sh.pwmth <- pairwise(sitemth,
                     groups = qdata$merged)
summary(sh.pwmth, 
        confidence = 0.95, 
        test.type = "dist")
```
